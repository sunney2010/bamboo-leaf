# 概述
>雪花算法（snowflake）是Twitter开源的分布式ID生成算法，支持多语言(Java、go、scala等),结果是一个64bit大小的整型的ID。

# 原生雪花算法（snowflake）
**结构图如下:**
![输入图片说明](https://images.gitee.com/uploads/images/2021/0113/132051_ae65503b_68305.jpeg "snowflake.jpg")

标识名称|位数|说明
--|:--:|:--
标识|1bit|正数是0，负数是1，ID一般是正数，最高位是0。
时间截|41bit|存储时间截的差值，41位的时间截，毫秒级，可以使用69年。
数据机器位|10bit|最大支持1024个节点，包括5位datacenterId和5位workerId。
序列号|12bit|毫秒内的计数，12位的计数顺序号最大支持每个节点每毫秒产生4096个ID序号。

**优点:**
1、本地生成，无依赖。
2、整型，趋势递增，有利于索引。
3、效率较高，理论每节点每秒最大能产生26万ID。
**不足：**
1、依赖机器时间，如果发生时钟回拨会导致可能生成id重复。
2、workid节点有限，无存储容易碰撞，在超大服务集群使用有风险。

# leaf-snowflake算法
leaf-snowflake在原生雪花算法的基本上进行了优化，在保持优点的的同时并得到增强。解决了原生雪花算法的不足。
优化点：
1、对雪花算法的各段位数进行了调整。
2、时间截从原来的微秒改为秒，性能得好了优化。
3、解决了时钟回拨会导致可能生成id重复。
4、workid节点个数增加到16383个。

**结构图如下:**
![输入图片说明](https://images.gitee.com/uploads/images/2021/0113/133130_8e50ec16_68305.jpeg "leaf-snowflake.jpg")

**时钟回拨解决方案**
![输入图片说明](https://images.gitee.com/uploads/images/2021/0113/133438_faf7674e_68305.jpeg "leaf-snowflake1.jpg")

总结：利用未来时间，来解决时钟回拨。
